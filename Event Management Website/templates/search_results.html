{% extends 'base.html' %}

{% block title %}Search Results{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/search_results.css') }}">
    <h1>Search Results for "{{ query }}"</h1>

    <div class="event-grid">
        {% if events %}
            {% for event in events %}
            <div class="event-card">
                <h2>{{ event[1] }}</h2> <h3>(Hosted by {{ event.host_name }}) </h3><!-- Assuming event name is in the 2nd column, and host_name is the last column -->
                <br> 
                <p><strong>Date:</strong> {{ event[2] }} at {{ event[3] }}</p>
                <p><strong>Location:</strong> {{ event[4] }}</p>
                <p><strong>Category:</strong> {{ event[8] }}</p>                
                <p><strong>Description:</strong> {{ event[5] }}</p>
                <p><strong>Guests:</strong> {{ event[6] }}</p>
                <a href="/event/{{ event[0] }}" class="button">View Event</a>
                <button class="rsvp-button" data-event-id="{{ event[0] }}">RSVP</button>

                <!-- Hidden RSVP form (pops up when RSVP is clicked) -->
                <div class="rsvp-popup" id="rsvp-form-{{ event[0] }}">
                    <span class="close-popup">&times;</span>
                    <form method="POST" action="/rsvp/{{ event[0] }}">
                        <label for="guests">Number of Guests (including yourself):</label>
                        <input type="number" name="guests" id="guests" min="1" required>
                        <button type="submit">Submit RSVP</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p>No events found for your search query.</p>
        {% endif %}
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
    // Attach event listeners to all RSVP buttons
    document.querySelectorAll('.rsvp-button').forEach(function(button) {
        button.addEventListener('click', function() {
            var eventId = this.getAttribute('data-event-id');
            var rsvpForm = document.getElementById('rsvp-form-' + eventId);
            var overlay = document.createElement('div');
            overlay.className = 'overlay';
            document.body.appendChild(overlay);
            rsvpForm.style.display = 'block';

            // Close popup on click of close button or overlay
            rsvpForm.querySelector('.close-popup').onclick = function() {
                rsvpForm.style.display = 'none';
                document.body.removeChild(overlay);
            };

            overlay.onclick = function() {
                rsvpForm.style.display = 'none';
                document.body.removeChild(overlay);
            };
        });
    });
});

    </script>
{% endblock %}
